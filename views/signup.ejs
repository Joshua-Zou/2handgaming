<!DOCTYPE html>
<html>

<body style="background-image: url(/images/signinbackground.png); width: 100%;">

    <body>
        <div class="login">
            <h1 style="text-align: center;">signup/signin</h1>
            <span style="text-align: center; color:rgb(224, 47, 47)" id="errorMessage"></span>
            <label for="login__username">email</label>
            <input type="text" id="login__username" required />
            <label for="login__password">password</label>
            <input type="password" id="login__password" required />
            <a href="#" style="text-decoration: none; color: rgb(224, 47, 47); margin-top: 10px;" onmousedown="showPass()" onmouseup="hidePass()">Show Password</a>
            <div class="login__section">
                <input type="checkbox" onclick="rememberMe()" id="login__remember" />
                <label for="login__remember">remember me</label>
                <a href="#" class="login__new-password">Forgot password?</a>
            </div>
            <div class="login__section-2">
                <a href="#" class="login__register login__button" onclick="register()">register</a>
                <button class="login__submit login__button" onclick="login()">login</button>
            </div>
            <div class="login__divider"></div>
            <div class="login__loginwith">
                <span>login/signup with facebook</span>
                <img src="https://image.flaticon.com/icons/png/512/145/145802.png" alt="facebook_icon" />
            </div>
            <div class="login__loginwith">
                <span>login/signup with google</span>
                <img src="https://image.flaticon.com/icons/png/512/281/281764.png" alt="google_icon" />
            </div>
            <div class="login__loginwith">
                <span>login/signup with github</span>
                <img src="https://cdn1.iconfinder.com/data/icons/logotypes/32/github-512.png" alt="github_icon" />
            </div>
        </div>
    </body>
</body>

</html>

<script>
    //
    String.prototype.replaceAll = function (find, replace) {
        var regex = new RegExp(find, 'g');
        return this.replace(regex, replace)
    }
    async function login() {
        let email = document.getElementById("login__username").value;
        let password = document.getElementById("login__password").value;
        if (email.replaceAll(" ", "") === "" || password.replaceAll(" ", "") === ""){document.getElementById("errorMessage").innerText = "Email/Password field must not be blank!"; fadeError()} 
        console.log(email, password);
        let returnedResult = await fetch("/api/login", {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({email: email, password: password})
        });
        returnedResult = await returnedResult.text();
        if (returnedResult !== "good") return document.getElementById("errorMessage").innerText = returnedResult;
        else window.location.href = "/app/dashboard";
    }
    async function register() {
        let email = document.getElementById("login__username").value;
        let password = document.getElementById("login__password").value;
        if (email.replaceAll(" ", "") === "" || password.replaceAll(" ", "") === ""){document.getElementById("errorMessage").innerText = "Email/Password field must not be blank!"; fadeError()} 
        console.log(email, password);
        let returnedResult = await fetch("/api/register", {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({email: email, password: password})
        });
        returnedResult = await returnedResult.text();
        if (returnedResult !== "good"){document.getElementById("errorMessage").innerText = returnedResult; fadeError()} 
        else{
            alert("An email has been sent to the email address! You have to confirm your email before you can login")
        }
    }

    function showPass(){
        document.getElementById("login__password").type = "text";
    }
    function hidePass(){
        document.getElementById("login__password").type = "password";
    }
    if (localStorage.getItem("rememberme") === "true") document.getElementById("login__remember").checked = true;
    function rememberMe() {
        if (!localStorage.getItem("rememberme") || localStorage.getItem("rememberme") === "false") localStorage.setItem("rememberme", "true");
        else localStorage.setItem("rememberme", "false")
    }
    async function fadeError(){
        let element = document.getElementById("errorMessage");
        for (var x = 0; x<100; x++){
            let opacity = 100-x;
            element.style.opacity = opacity.toString()+"%";
            await sleep(10)
        }
        element.innerHTML = "&nbsp;";
        delete element.style.opacity;
    }
    function sleep(ms){
        return new Promise(resolve => setTimeout(resolve, ms));
    }
</script>

<style>
    * {
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        font-family: "Roboto", sans-serif;
        -webkit-tap-highlight-color: transparent;
    }

    html,
    body {
        padding: 0;
        margin: 0;
        display: -ms-grid;
        display: grid;
        place-items: center;
        height: 100vh;
        background: #f8f9ff;
        color: rgba(0, 0, 0, 0.7);
    }

    .login {
        width: 400px;
        min-height: 300px;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -ms-flex-direction: column;
        flex-direction: column;
        background: white;
        padding: 1em 2em;
        border-radius: 1em;
        -webkit-box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
    }

    .login #login__username,
    .login #login__password {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        outline: none;
        border: 1px solid rgba(0, 0, 0, 0.3);
        border-radius: 0.6em;
        height: 2em;
        padding-left: 1em;
    }

    .login>label {
        margin-top: 1em;
        margin-bottom: 0.3em;
    }

    .login .login__section {
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center;
        margin: 1em 0 2em 0;
    }

    .login .login__section #login__remember {
        position: relative;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        outline: none;
        width: 3em;
        height: 1.5em;
        background: #e2e2e2;
        margin-right: 0.5em;
        border: 0;
        border-radius: calc(1.5em / 2);
        cursor: pointer;
    }

    .login .login__section #login__remember::after {
        content: "";
        position: absolute;
        top: 0.25em;
        left: 0.25em;
        width: 1em;
        height: 1em;
        border-radius: 50%;
        background: rgba(0, 0, 0, 0.3);
        -webkit-transition: all 0.2s;
        transition: all 0.2s;
    }

    .login .login__section #login__remember:checked::after {
        -webkit-transform: translateX(1.5em);
        transform: translateX(1.5em);
        background: #42a5f5;
    }

    .login .login__section .login__new-password {
        margin-left: auto;
        text-decoration: none;
        color: rgb(224, 47, 47);
    }

    .login .login__button {
        cursor: pointer;
        outline: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        border-radius: 0.6em;
        border: 0;
        max-width: -webkit-max-content;
        max-width: -moz-max-content;
        max-width: max-content;
        padding: 0.7em 2em;
        color: white;
        text-decoration: none;
        font-size: 1em;
    }

    .login .login__section-2 {
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
    }

    .login .login__section-2 .login__submit {
        margin-left: auto;
        background: #42a5f5;
    }

    .login .login__section-2 .login__register {
        background: #333333;
    }

    .login .login__divider {
        display: block;
        width: 100%;
        height: 1px;
        background: #e6e6e6;
        margin: 1em 0;
    }

    .login .login__loginwith {
        height: 2.5em;
        border-radius: 0.7em;
        background: white;
        margin: 0.3em 0;
        padding: 0 1em;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center;
        -webkit-box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
        cursor: pointer;
    }

    .login .login__loginwith img {
        height: 2em;
        margin-left: auto;
    }
</style>